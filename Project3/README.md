# SM3 哈希函数 - 实现与优化

作者：李云昊
许可证：MIT  
联系邮箱：1779551322@qq.com  

## 📌 项目概述

本项目旨在实现 SM3 国密哈希函数的标准版本，并在此基础上进行多种软件层面的优化。项目包括：
- 一个 **基础参考实现**（标准 SM3 算法）
- 三种不同的优化版本：
  - 使用宏定义优化（Macro）
  - 使用循环展开优化（Loop Unrolling）
  - 使用 SIMD 指令优化（如 SSE）
- 一个 **统一的 benchmark 工具**，用于测试各版本性能

---

## 📐 优化策略说明

### 1. ✅ 宏定义优化（Macro）
**目的：** 减少函数调用开销，提升循环执行效率。

**示例：**
```c
#define ROTL(x,n) (((x) << (n)) | ((x) >> (32 - (n))))
#define P0(x) ((x) ^ ROTL((x), 9) ^ ROTL((x), 17))
```
像 `ROTL` 和 `P0` 这样的宏可以减少 CPU 分支跳转。

---

### 2. ✅ 循环展开（Loop Unrolling）
**目的：** 减少循环判断逻辑开销，提升流水线并行度。

**思想：**
```c
// 将原本的 for 循环展开成多个独立的语句块，避免分支判断
```
可以更好地利用编译器指令调度能力，加快压缩函数计算。

---

### 3. ✅ SIMD 指令优化（SSE）
**目的：** 利用 SIMD 寄存器并行处理多个 32 位字，加速 SM3 的消息扩展和状态更新。

**常用指令（SSE Intrinsics）：**
```c
__m128i _mm_xor_si128(__m128i a, __m128i b);      // 128位按位异或
__m128i _mm_slli_epi32(__m128i a, int n);         // 左移逻辑
__m128i _mm_srli_epi32(__m128i a, int n);         // 右移逻辑
```

**P1函数 SIMD 实现示例：**
```c
P1(x) = x ^ (x <<< 15) ^ (x <<< 23)
```
用 SIMD 可表示为：
```c
__m128i p1 = _mm_xor_si128(x, _mm_xor_si128(rol15, rol23));
```

---

## 📎 项目结构

```bash
.
├── sm3_basic.c / sm3_basic.h         # 标准 SM3 实现
├── sm3_optimized.c / sm3_optimized.h # 包含三种优化方式（Macro / Unroll / SIMD）
├── benchmark.c                       # 性能测试主程序
└── README.md                         # 项目说明文档（中/英文）
```

---

## 📊 实验结果（需运行后填写）

| 实现版本     | 平均耗时 (ms) | 相对加速比 |
|--------------|----------------|-------------|
| 基础版本     |                | 1.00×       |
| 宏定义优化   |                |             |
| 循环展开优化 |                |             |
| SIMD优化     |                |             |

> 运行 `./benchmark` 后补全本表格数据。

---

## 📜 开源许可证

本项目使用 [MIT 协议](https://opensource.org/licenses/MIT) 进行开源。  
您可以自由使用、修改、发布本代码，需注明原作者。

---

## 📫 联系方式

如有建议、问题或合作意向，欢迎联系作者：  
📧 **邮箱：** 1779551322@qq.com